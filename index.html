<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Web3 VPN</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #0b0f19;
            color: white;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }
        /* –ê–Ω–∏–º–∞—Ü–∏—è —Ñ–æ–Ω–∞ */
        .bg-gradient-glow {
            background: radial-gradient(circle at 50% -20%, #4f46e5 0%, transparent 40%),
                        radial-gradient(circle at 100% 50%, #ec4899 0%, transparent 30%);
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
        }
        /* –°—Ç–µ–∫–ª–æ–º–æ—Ä—Ñ–∏–∑–º */
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
        }
        /* –ù–µ–æ–Ω–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞ */
        .neon-btn {
            background: linear-gradient(90deg, #4f46e5, #9333ea);
            box-shadow: 0 0 20px rgba(79, 70, 229, 0.5);
            transition: all 0.3s ease;
        }
        .neon-btn:active { transform: scale(0.95); }
        
        /* –¢–∞–±—ã */
        .tab-content { display: none; animation: fadeIn 0.4s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-item.active { color: #fff; text-shadow: 0 0 10px rgba(255,255,255,0.5); }
        .nav-item { color: #6b7280; transition: color 0.3s; }
    </style>
</head>
<body class="pb-24">

    <div class="bg-gradient-glow"></div>

    <div class="p-6 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center shadow-lg shadow-indigo-500/30">
                <i class="fas fa-shield-alt text-white text-lg"></i>
            </div>
            <div>
                <h1 class="font-bold text-lg">Web3 VPN</h1>
                <p class="text-xs text-gray-400">Secure & Fast</p>
            </div>
        </div>
        <div class="glass-card px-3 py-1 text-xs text-green-400 font-mono">
            ‚óè ONLINE
        </div>
    </div>

    <div id="tab-home" class="tab-content active p-6 pt-2">
        <div class="glass-card p-8 text-center relative overflow-hidden mb-6">
            <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-indigo-500 to-transparent"></div>
            
            <h2 class="text-gray-400 text-sm tracking-wider mb-2">SUBSCRIPTION</h2>
            <div id="status-text" class="text-3xl font-bold text-white mb-1">Inactive</div>
            <div id="days-text" class="text-sm text-gray-500 mb-6">No active plan</div>

            <button onclick="requestConfig()" class="neon-btn w-full py-4 rounded-xl font-bold text-white flex items-center justify-center gap-2">
                <i class="fas fa-power-off"></i> CONNECT
            </button>
        </div>

        <div id="trial-card" class="glass-card p-4 flex justify-between items-center border-indigo-500/30 border">
            <div>
                <div class="font-bold text-indigo-300">Free Trial</div>
                <div class="text-xs text-gray-400">Try 24 hours for free</div>
            </div>
            <button onclick="activateTrial()" class="bg-indigo-600/20 text-indigo-300 px-4 py-2 rounded-lg text-sm hover:bg-indigo-600/40 transition">
                Activate
            </button>
        </div>
    </div>

    <div id="tab-plans" class="tab-content p-6 pt-2">
        <h2 class="text-xl font-bold mb-4">Choose Plan</h2>
        <div class="space-y-4">
            <div onclick="buy(2, 30, 2.0, '1 Month')" class="glass-card p-5 cursor-pointer active:scale-95 transition hover:border-indigo-500/50">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="font-bold text-lg">1 Month</h3>
                    <span class="bg-white/10 px-2 py-1 rounded text-xs">Popular</span>
                </div>
                <div class="text-3xl font-bold mb-1">2.0 <span class="text-sm font-normal text-gray-400">USDT</span></div>
                <p class="text-xs text-gray-400">High speed, Unlimited data</p>
            </div>
            <div onclick="buy(3, 90, 5.0, '3 Months')" class="glass-card p-5 cursor-pointer active:scale-95 transition hover:border-pink-500/50 relative">
                <div class="absolute -right-2 -top-2 bg-pink-500 text-white text-[10px] px-2 py-1 rounded-full font-bold">SAVE 15%</div>
                <h3 class="font-bold text-lg mb-2">3 Months</h3>
                <div class="text-3xl font-bold mb-1 text-pink-400">5.0 <span class="text-sm font-normal text-gray-400">USDT</span></div>
                <p class="text-xs text-gray-400">Best value for season</p>
            </div>
        </div>
    </div>

    <div id="tab-profile" class="tab-content p-6 pt-2">
        <div class="flex flex-col items-center mb-8">
            <div class="w-20 h-20 rounded-full bg-gradient-to-br from-indigo-500 to-pink-500 p-1 mb-3">
                <img src="https://upload.wikimedia.org/wikipedia/commons/2/2c/Default_pfp.svg" class="w-full h-full rounded-full bg-black object-cover">
            </div>
            <div id="username" class="font-bold text-xl">User</div>
            <div class="text-xs text-gray-400">ID: <span id="userid">...</span></div>
        </div>

        <div class="grid grid-cols-2 gap-4 mb-6">
            <div class="glass-card p-4 text-center">
                <div id="ref-count" class="text-2xl font-bold text-indigo-400">0</div>
                <div class="text-xs text-gray-400">Referrals</div>
            </div>
            <div class="glass-card p-4 text-center">
                <div id="balance" class="text-2xl font-bold text-green-400">0.0 $</div>
                <div class="text-xs text-gray-400">Balance</div>
            </div>
        </div>

        <div class="glass-card p-4">
            <div class="text-xs text-gray-400 mb-2">YOUR INVITE LINK</div>
            <div class="flex gap-2">
                <input id="ref-link" type="text" readonly class="w-full bg-black/30 rounded px-3 py-2 text-sm text-gray-300 outline-none" value="...">
                <button onclick="copyLink()" class="bg-indigo-600 px-3 py-2 rounded text-white"><i class="fas fa-copy"></i></button>
            </div>
            <p class="text-[10px] text-gray-500 mt-2">Invite friends and get 10% from their payments.</p>
        </div>
    </div>

    <div class="fixed bottom-0 left-0 w-full glass-card border-t border-white/10 rounded-b-none pb-safe">
        <div class="flex justify-around p-4 pb-6">
            <button onclick="switchTab('home')" class="nav-item active flex flex-col items-center gap-1" id="nav-home">
                <i class="fas fa-home text-xl"></i>
                <span class="text-[10px]">VPN</span>
            </button>
            <button onclick="switchTab('plans')" class="nav-item flex flex-col items-center gap-1" id="nav-plans">
                <i class="fas fa-bolt text-xl"></i>
                <span class="text-[10px]">Plans</span>
            </button>
            <button onclick="switchTab('profile')" class="nav-item flex flex-col items-center gap-1" id="nav-profile">
                <i class="fas fa-user text-xl"></i>
                <span class="text-[10px]">Profile</span>
            </button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö –∏–∑ URL (–æ—Ç –±–æ—Ç–∞)
        const urlParams = new URLSearchParams(window.location.search);
        let userData = {};
        
        try {
            const rawData = urlParams.get('data');
            if(rawData) {
                userData = JSON.parse(decodeURIComponent(rawData));
            }
        } catch(e) { console.error("Error parsing data", e); }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        document.addEventListener('DOMContentLoaded', () => {
            const user = tg.initDataUnsafe.user || {id: 0, first_name: 'Guest'};
            
            // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
            document.getElementById('username').innerText = user.first_name;
            document.getElementById('userid').innerText = userData.uid || user.id;
            document.getElementById('ref-count').innerText = userData.refs || 0;
            document.getElementById('balance').innerText = (userData.balance || 0).toFixed(1) + " $";
            
            // –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞
            // –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ 'MyVpnBot' –Ω–∞ —é–∑–µ—Ä–Ω–µ–π–º –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
            const botUsername = "MyVpnBot"; 
            document.getElementById('ref-link').value = `https://t.me/${botUsername}?start=${userData.uid || user.id}`;

            // –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏
            if (userData.sub === 'active') {
                document.getElementById('status-text').innerText = "Active üü¢";
                document.getElementById('status-text').className = "text-3xl font-bold text-green-400 mb-1";
                document.getElementById('days-text').innerText = `${userData.days} days left`;
            }

            // –°–∫—Ä—ã—Ç—å —Ç—Ä–∏–∞–ª, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω
            if (userData.trial == 1) {
                document.getElementById('trial-card').style.display = 'none';
            }
        });

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById('nav-' + tabId).classList.add('active');
            
            tg.HapticFeedback.selectionChanged();
        }

        // –õ–æ–≥–∏–∫–∞ –∫–Ω–æ–ø–æ–∫
        function activateTrial() {
            tg.HapticFeedback.impactOccurred('medium');
            tg.sendData(JSON.stringify({ action: 'trial' }));
            tg.close();
        }

        function buy(id, days, price, name) {
            tg.HapticFeedback.impactOccurred('heavy');
            tg.sendData(JSON.stringify({ 
                action: 'buy', 
                id: id, 
                days: days, 
                price: price, 
                name: name 
            }));
            tg.close();
        }

        function requestConfig() {
            tg.HapticFeedback.impactOccurred('light');
            tg.sendData(JSON.stringify({ action: 'get_config' }));
            tg.close();
        }

        function copyLink() {
            const input = document.getElementById('ref-link');
            input.select();
            document.execCommand('copy');
            tg.HapticFeedback.notificationOccurred('success');
            alert('Link copied!');
        }
    </script>
</body>
</html>
